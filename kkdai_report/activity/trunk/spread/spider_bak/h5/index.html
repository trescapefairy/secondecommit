<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" id="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta content="telephone=no" name="format-detection">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/activity_register.css">
    <script type="text/javascript" src="js/conf.js"></script>
    <script type="text/javascript" src="js/device.min.js"></script>
    <script type="text/javascript">
        if (device.desktop()) {
            window.location.href = __CONF__.webUrl;
        }
    </script>
    <script src="js/jquery-1.11.3.min.js"></script>
    <title>活动注册</title>
</head>
<body>
<div class="banner"><img src="http://image.kuaikuaidai.com/activity/spider/59d661e36a72401ab9402daf4cc83330.jpg"></div>
<div class="new_user">
    <p>新用户首次投资满1000元 即送电影票一张 100%中奖</p>
    <p>( 不包含 "天天赚" )</p>
    <img src="http://image.kuaikuaidai.com/activity/spider/616f45215919490e86052c710f673baa.jpg" class="pic">
</div>
<div class="quan">
    <div class="dianyingquan"><img src="http://image.kuaikuaidai.com/activity/spider/b0b3f04c54e34da08d92da4baacf1a09.jpg"></div>
    <div class="dixianquan"><img src="http://image.kuaikuaidai.com/activity/spider/0de0e907a73f4a53b5bee29c1f70583b.jpg"></div>
</div>
<div class="activity_register">
    <form id="reg" class="register">
        <h3>
            <span>0元看电影  在此注册</span>
            <img src="http://image.kuaikuaidai.com/activity/spider/616f45215919490e86052c710f673baa.jpg" class="pic01">
        </h3>
        <div class="border_line">
            <input type="tel" name="phone" placeholder="请输入您要注册的手机号码" class="input01 hh validate validateEmpty validatePhone" maxlength="11">
        </div>
        <p class="tishi">必填</p>
        <div class="border_line">
            <input type="password" name="password" placeholder="请输入6-16位由数字、字母组成的密码" class="input01 hh validate validateEmpty validatePassword" maxlength="16">
        </div>
        <p class="tishi">必填</p>
        <div class="border_line">
            <input type="tel" name="code" placeholder="手机验证码" class="input02 hh validate validateEmpty validateCode">
            <input type="button" id="secondSpan" onclick="javascript:getIdentCode();" value="获取验证码" class="yzm">
        </div>

        <p class="tishi">必填</p>
        <div class="xieyi"><span class="pic04"><img src="http://image.kuaikuaidai.com/activity/spider/f13a0f3de997409a860fe7f9626912c5.jpg"></span>&nbsp;<span>我已阅读并同意<a href="http://www.kuaikuaidai.com/h5/baseservice.html">《快快贷网站服务协议》</a></div>
        <div class="reg">
            <input type="button" id="register" value="注册就送188元红包" class="btn" onclick="javascript:submitReg();">
        </div>
        <div class="tk" style="display:none;"></div>
    </form>
</div>
<div class="rules">
    <div class="rules_title">
        <span>活动规则</span>
        <img src="http://image.kuaikuaidai.com/activity/spider/616f45215919490e86052c710f673baa.jpg" class="pic03">
    </div>
    <p>1、本活动仅面向通过本页面注册的新用户；</p>
    <p>2、活动时间：2016年1月15日0:00-2016年2月14日23:59:59；</p>
    <p>3、所有新注册用户都将获得188元的抵现券；</p>
    <p>4、首次投资≥1000元（不包含天天赚）即可获得电影通兑券；</p>
    <p>5、电影票通兑券会在投资成功后的3小时内，以短信形式发送到您注册的手机号码上；</p>
    <p>6、电影票通兑券使用规则以蜘蛛网现有规则为准。</p>
</div>
<div class="lianjie"><a href="http://www.kuaikuaidai.com/h5/">进入首页</a></div>
<p class="rexian"><i><img src="images/tel.png"></i>&nbsp;<span>客服热线：4000-137-000  服务时间:9:00-21:00</span></p>

<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?2cd07a5ebaa7043e8db6a9cc1a68afce";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
</script>

</body>
<script type="text/javascript" src="js/conf.js"></script>
<script type="text/javascript" src="js/activity_register.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript" src="js/validate.js"></script>
<script type="text/javascript">
    var _md_lastRegSuc_='0', _md_lastSendCode_='0', _md_lastFormData='0', _md_lastForm='0';
    var maxcount = 60;
    var countdown = maxcount;
    var intervalid;
    function disableTime() {
        $('#secondSpan').attr('disabled', 'disabled');
        $('#secondSpan').addClass('yzm_gray');
        countdown--;
        if (countdown == 0) {
            countdown = maxcount;
            $('#secondSpan').val('重发验证码');
            $('#secondSpan').removeClass('yzm_gray');
            $('#secondSpan').removeAttr('disabled');
            window.clearInterval(intervalid);
        } else {
            $('#secondSpan').val(countdown + '秒后重发')
        }
    }

    $(function () {
        if (device.ios() || device.ipad() || device.iphone() || device.ipod()) {
            $('.rules').append('<p>7、活动由快快贷提供，与苹果公司无关。</p>');
        }

        addCookie('source', 'spider', 3, '.kuaikuaidai.com');


        $(reg.phone).focus(function(){_md_lastForm = 'a'});
        $(reg.password).focus(function(){_md_lastForm = 'b'});
        $(reg.code).focus(function(){_md_lastForm = 'c'});
    });

    $(window).unload(function() {
        _md_lastFormData = {'a':$(reg.phone).val().length,'b':$(reg.code).val().length,'c':$(reg.code).val().length,'reged':_md_lastRegSuc_,'sendcode':_md_lastSendCode_,'fm':_md_lastFormData,'lt':_md_lastForm,'source':'spider','channel':'h5'};
        jQuery.ajax({
            type : "GET",
            url : '/evt_reg.php',
            data : _md_lastFormData,
            dataType : 'jsonp',
            jsonp : 'callback',
            success : function(result) {}
        });
    });

    function checkIdentCode() {
        if($(reg.code).closest('div').next('.tishi').text() == "") {
            var str = reg.code.value;
            if (!isEmpty(str)) {
                if (str.length != 4) {
                    $(reg.code).closest('div').next('.tishi').text('验证码输入不正确').show();
                    return false;
                } else {
                    if (!isDigit(str)) {
                        $(reg.code).closest('div').next('.tishi').text('验证码输入不正确').show();
                        return false;
                    }
                }
            } else {
                $(reg.code).closest('div').next('.tishi').text('验证码输入不正确').show();
                return false;
            }
        }
        return true;
    }

    function checkPhone() {
        if($(reg.phone).closest('div').next('.tishi').text() == "") {
            var str = reg.phone.value;
            if (!isEmpty(str)) {
                if (isDigit(str)) {
                    if (!isMobile(str)) {
                        $(reg.phone).closest('div').next('.tishi').text('请输入13、14、15、17、18开头的11位手机号码').show();
                        return false;
                    } else {
                        $(reg.phone).closest('div').next('.tishi').text('').hide();
                        $(reg.phone).removeClass("ipt_wrong").addClass("hh");
                        return true;
                    }
                } else {
                    $(reg.phone).closest('div').next('.tishi').text('请输入13、14、15、17、18开头的11位手机号码').show();
                    return false;
                }
            } else {
                $(reg.phone).closest('div').next('.tishi').text('请输入13、14、15、17、18开头的11位手机号码').show();
                return false;
            }
        }
        return true;
    }

    function checkPassWord() {
        if ($(reg.password).closest('div').next('.tishi').text() == "") {
            var password = reg.password.value;
            if (!isEmpty(password)) {
                if(password.length < 6 || password.length > 16) {
                    $(this).closest('div').next('.tishi').text("请输入6到16位由数字，字母组成的密码").show();
                    return false;
                }
                var pattern = /^[a-zA-Z0-9]+$/;
                if(!password.match(pattern)) {
                    $(this).closest('div').next('.tishi').text("请输入6到16位由数字，字母组成的密码").show();
                    return false;
                }
            } else {
                $(this).closest('div').next('.tishi').text("请输入6到16位由数字，字母组成的密码").show();
                return false;
            }
        }
        return true;
    }

    function getIdentCode() {
        $(reg.phone).trigger("blur");
        _md_lastSendCode_ = '1';
        $('#secondSpan').attr('disabled', 'disabled');
        if($(reg.phone).closest('div').find('.tishi').text() == "" && $(reg.code).closest('div').find('.tishi').text() == ""){
            var str = reg.phone.value;
            if (!isEmpty(str)) {
                if (isDigit(str)) {
                    if (!isMobile(str)) {
                        $(reg.phone).closest('div').next('.tishi').text('请输入13、14、15、17、18开头的11位手机号码').show();
                        $('#secondSpan').removeAttr('disabled');
                        return;
                    }
                } else {
                    $(reg.phone).closest('div').next('.tishi').text('请输入13、14、15、17、18开头的11位手机号码').show();
                    $('#secondSpan').removeAttr('disabled');
                    return;
                }
            } else {
                $(reg.phone).closest('div').next('.tishi').text('请输入13、14、15、17、18开头的11位手机号码').show();
                $('#secondSpan').removeAttr('disabled');
                return;
            }

            var req = {"phone":reg.phone.value};
            myAjax(__CONF__.sendIdentCodeUrl, req, function (result) {
                if (result.code == 0) {
                    showTk('验证码已发送');
                    intervalid = setInterval(function(){ disableTime()},1000);
                } else if (result.code == 209 || result.code == 230 || result.code == 231 || result.code == 247 || result.code == 249){
                    if (result.code != 209) {
                        intervalid = setInterval(function(){ disableTime()},1000);
                    }
                    showTk(result.desc);
                } else {
                    showTk('验证码发送失败，请稍后再试');
                    intervalid = setInterval(function(){ disableTime()},1000);
                }
            });
        }
        $('#secondSpan').removeAttr('disabled');
    }

    function submitReg() {
        var retVal = validateForm(reg.phone);
        if (retVal['error'] == 0 && checkPhone() && checkPassWord() && checkIdentCode()) {
            var req = {"phone": reg.phone.value, "code": reg.code.value, "password": reg.password.value, "channel":"H5", "source":"spider"}
            myAjax(__CONF__.regUrl, req, function (result) {
                if (result.code == 0) {
                    _md_lastRegSuc_ = '1';
                    var logVal = {"username":reg.phone.value,"password":reg.password.value};
                    myAjax(__CONF__.loginUrl, logVal, function(logRet){
                        if(logRet.code == 0) {
                            window.location.href=__CONF__.regSucJumpUrl;
                        }
                    }, true);
                } else if(result.code == 209 || result.code == 227 || result.code == 228) {
                    showTk(result.desc);
                }  else {
                    showTk('注册失败，请重新注册');
                }
            });
        }
    }

    function showTk(msg) {
        $('.tk').html(msg);
        $('.tk').show();
        setTimeout("$('.tk').fadeOut(1000)", 1000);
    }

    function addCookie(objName, objValue, objHours, domain) {
        var str = objName + "=" + encodeURI(objValue);
        if (objHours > 0) {
            var date = new Date();
            var ms = objHours * 3600 * 1000;
            date.setTime(date.getTime() + ms);
            str += "; expires=" + date.toGMTString() + "; domain=" + domain + "; path=/";
        }
        document.cookie = str;
    }
</script>
</html>
### 说明
- 系统设计目标是收集（自动采集或人工录入）平台，财务，业务数据后，提供一个整合后的报表平台。
- 工作目录是/var/www/licai_php,后面文档中,凡是没有用绝对路径的地方，都是指在工作目录下的某个相对路径下的。
- 数据库表中相关字段说明，参看kkdai_database.md
- 后台登入地址 http://120.55.84.244/manage/manager/login, 默认用户root，默认密码123456

### 业务子系统
增设子系统权限，拥有子系统的权限的人才能访问相应的数据（类型以及从属关系）。

数据来源靠录入，数据及报表参看<<业务周报（模板）>>

几点说明：

- 户数：可能一个用户借了几笔，所以不能简单累加，一期采用直接录入的方式，放在录入后周报确认的操作上
- 展期：指的是续借。
- 数据录入：提供人工修改的地方，这边线下业务特例非常多，后面如果做流水的话，要活用标志位和说明字段。

### 财务子系统
增设子系统权限，拥有子系统的权限的人才能访问相应的数据（类型以及从属关系）。

数据来源靠录入，数据及报表参看<<财务报表 (模板)>>

数据报表像其他报表一样拆分：收入&支出&存量（三个统计类,evtdaily里act中三个不同的），4个领域（flgext01标志位字段）

### 报表系统
增设子系统权限，拥有子系统的权限的人才能访问相应的数据（类型）。

### 系统数据流

1. 线上平台通过主从复制方式把数据库复制到镜像库（phoenix）
2. 系统定时任务（application/Cronds/Standalone/下）从线上库的镜像库中拉取数据，转换成报表系统需要的格式，在本地的db_kkrpt中保存下来（包括用户数据tb_user_final，订单数据tb_orders_final，商品数据tb_wares_final，充值提现流水tb_recharges_final，绑卡tb_bankcard_final等）
3. 系统定时任务（application/Cronds/RptDaily/下）会在转换好的数据的基础上统计每天的日报（表tb_evtdaily;月报放二期）数据。

### 测试环境

- 120.55.83.55上有从线上copy下来的数据库，作为原始数据来源；
- 120.55.84.244上部署了报表系统的代码
- run目录下，放置了几个工具：

| 工具        | 用途                         |
| ----------- | --------------------------- |
| loopall.php | 运行指定定时任务，执行日期从2014-7-1到今天，用法 php loopall.php RptDaily.EDAccounts |
| redo.sh     | 运行所有的定时任务(忘记了什么任务需要哪个命令，可以这里找)，执行日期从2014-7-1到今天，用法： bash < reso.sh |